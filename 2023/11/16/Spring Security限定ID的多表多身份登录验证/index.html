<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="1.前言​	本文说明了如何使用Spring Security在下述情况下进行登录验证: ​	系统有两个身份,用户和管理员,用户和管理员的用户名和密码存储在两张MySQL表中,存在两个登录界面,保证用户只能访问用户的操作界面,管理员只能访问管理员权限;并且用户只能访问自己的主页,不能访问其他用户的主页,即页面ID(体现在网址中)与登录用户的ID一一对应. ​	项目使用Spring框架搭建服务器,使用">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Security:限定ID的多表多身份登录验证">
<meta property="og:url" content="http://example.com/2023/11/16/Spring%20Security%E9%99%90%E5%AE%9AID%E7%9A%84%E5%A4%9A%E8%A1%A8%E5%A4%9A%E8%BA%AB%E4%BB%BD%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81/index.html">
<meta property="og:site_name" content="月 夜 梦 灵">
<meta property="og:description" content="1.前言​	本文说明了如何使用Spring Security在下述情况下进行登录验证: ​	系统有两个身份,用户和管理员,用户和管理员的用户名和密码存储在两张MySQL表中,存在两个登录界面,保证用户只能访问用户的操作界面,管理员只能访问管理员权限;并且用户只能访问自己的主页,不能访问其他用户的主页,即页面ID(体现在网址中)与登录用户的ID一一对应. ​	项目使用Spring框架搭建服务器,使用">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-11-16T06:37:45.291Z">
<meta property="article:modified_time" content="2023-12-04T13:01:22.505Z">
<meta property="article:author" content="YQYjin">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2023/11/16/Spring%20Security%E9%99%90%E5%AE%9AID%E7%9A%84%E5%A4%9A%E8%A1%A8%E5%A4%9A%E8%BA%AB%E4%BB%BD%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Spring Security:限定ID的多表多身份登录验证 | 月 夜 梦 灵</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">月 夜 梦 灵</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/11/16/Spring%20Security%E9%99%90%E5%AE%9AID%E7%9A%84%E5%A4%9A%E8%A1%A8%E5%A4%9A%E8%BA%AB%E4%BB%BD%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="YQYjin">
      <meta itemprop="description" content="任 重 而 道 远">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="月 夜 梦 灵">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Spring Security:限定ID的多表多身份登录验证
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-11-16 14:37:45" itemprop="dateCreated datePublished" datetime="2023-11-16T14:37:45+08:00">2023-11-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-04 21:01:22" itemprop="dateModified" datetime="2023-12-04T21:01:22+08:00">2023-12-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">工程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h1><p>​	本文说明了如何使用Spring Security在下述情况下进行登录验证:</p>
<p>​	系统有两个身份,用户和管理员,用户和管理员的用户名和密码存储在两张MySQL表中,存在两个登录界面,保证用户只能访问用户的操作界面,管理员只能访问管理员权限;并且用户只能访问自己的主页,不能访问其他用户的主页,即页面ID(体现在网址中)与登录用户的ID一一对应.</p>
<p>​	项目使用Spring框架搭建服务器,使用MyBatis-plus操作MySQL数据库,使用Maven进行项目管理.</p>
<span id="more"></span>

<h1 id="2-依赖"><a href="#2-依赖" class="headerlink" title="2.依赖"></a>2.依赖</h1><p>​	要在Maven项目中使用Spring Security框架,目前的Spring框架已经继承了Spring Security框架,因此仅需向pom.xml文件中加入Spring Security启动器依赖.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="3-登录验证"><a href="#3-登录验证" class="headerlink" title="3. 登录验证"></a>3. 登录验证</h1><h2 id="3-1开启Spring-Security"><a href="#3-1开启Spring-Security" class="headerlink" title="3.1开启Spring Security"></a>3.1开启Spring Security</h2><p>​	开启Spring Security只需要创建配置类,该类用于配置Spring Security的规则,处理方法等</p>
<p>​	创建配置类并使其生效需要使该类继承自<code>WebSecurityConfigurerAdapter</code>,并重新其中的<code>configure(HttpSecurity http)</code>方法,登录验证的设置都存放在configure方法中.除此之外要为该类添加注解<code>@EnableWebSecurity</code>和<code>@Configuration</code>.</p>
<p>​	由于Spring Security验证密码是进行加密过的,因此需要一个密码加密器,默认使用<code>BCryptPasswordEncoder</code>,创建一个方法获取密码加密器,并将其注册为Bean.密码加密器只需要注册一次,如果有多个配置类,在一个类中配置后其他类不需要再次配置.</p>
<p>​	重写<code>configure(AuthenticationManagerBuilder auth)</code>用于进行登录,该方法中需要<code>userDetailsService</code>对象作为登录处理的方法类和一个密码加密器用于对前端发送的登录密码进行加密.</p>
<p>​	以下是一个基础的Spring Security配置类,规则为放行所有请求:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityTest</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            http</span><br><span class="line">                .csrf().disable()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .anyRequest()</span><br><span class="line">                .permitAll();       </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        auth.userDetailsService(myUserDetailsService).passwordEncoder(passwordEncoder());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-2-配置登录验证"><a href="#3-2-配置登录验证" class="headerlink" title="3.2 配置登录验证"></a>3.2 配置登录验证</h2><p>​	Spring Security的配置方法为链式编程,可以不限制地不断添加配置,不同类的配置通过<code>.and()</code>隔开</p>
<h3 id="开启登录验证"><a href="#开启登录验证" class="headerlink" title="开启登录验证"></a>开启登录验证</h3><p>​	开启登录验证通过配置<code>configure</code>函数实现,配置时以<code>http</code>作为开头.</p>
<ul>
<li>添加<code>.authorizeRequests()</code>表示对请求进行登录验证</li>
<li>添加<code>.antMatchers(&quot;/admin/**&quot;).hasRole(&quot;ADMIN&quot;)</code>表示对匹配”&#x2F;admin&#x2F;**”规则的请求需要登录用户具有”ADMIN”身份,<code>.antMatchers(&quot;/admin/**&quot;)</code>可以添加多个以匹配所有请求</li>
<li>可以添加<code>.permitAll()</code>,表示未匹配到之前规则的请求全部放行,注意在该配置后的全部<code>.antMatchers()</code>都会失效,因此应防止在最后</li>
<li>可以添加<code>.csrf().disable()</code>以关闭CSRF检查,开启后需要额外配置登录表单以满足检查,否则无法登录.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/admin/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">            	.permitAll()</span><br><span class="line">            	.csrf().disable();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="自定登录界面"><a href="#自定登录界面" class="headerlink" title="自定登录界面"></a>自定登录界面</h2><p>​	Spring Security带有默认的登录界面,但往往不能满足需求,因此需要将登录界面设置为我们的登录界面,同样在<code>configure</code>中进行配置.</p>
<ul>
<li><p><code>.and()</code>来连接不同的配置</p>
</li>
<li><p><code>.formLogin()</code>来说明配置登录</p>
</li>
<li><p><code>.loginPage(&quot;&quot;)</code>配置自定的登录界面的路由</p>
</li>
<li><p><code>.loginProcessingUrl(&quot;&quot;)</code>配置登录请求的路由,即要把登录表单(用户名,密码)发送到的网址.</p>
</li>
<li><p><code>.successHandler()</code>配置登录成功处理器,即登录成功后进行的操作,用于较复杂的处理,简单的可以直接设置跳转到某个网址.</p>
</li>
<li><p><code>failureHandler()</code>配置登录失败处理器,即登录失败后进行的操作,与登录成功处理器一致.</p>
</li>
</ul>
<p> <span style="color:red;">注意:</span> Spring Security对登录表单具有默认值,用户名默认为”username”,密码默认为”password”,Spring Security默认获取提交的json表单中的这两个字段作为用户名和密码,如果提交的表单与默认值不一致,会导致无法获取到用户名和密码,可以通过修改提交的表单的键或修改Spring Security的配置,通过<code>.passwordParameter()</code>和<code>.usernameParameter()</code>来自定登录表单的键.</p>
<p>​	最后添加<code>.permitALL()</code>使所有人都可以访问登录界面,修改后的配置如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/admin/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">            	.permitAll()</span><br><span class="line">            	.and()</span><br><span class="line">                .formLogin()</span><br><span class="line">                .loginPage(<span class="string">&quot;/adminloginpage&quot;</span>)</span><br><span class="line">                .loginProcessingUrl(<span class="string">&quot;/admin/login&quot;</span>)</span><br><span class="line">                .successHandler(<span class="keyword">new</span> <span class="title class_">AdminAuthenticationSuccessHandler</span>())</span><br><span class="line">                .failureHandler(<span class="keyword">new</span> <span class="title class_">AdminAuthenticationFailureHandler</span>())</span><br><span class="line">                .permitAll()</span><br><span class="line">            </span><br><span class="line">            	.csrf().disable();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="登出和拒绝访问"><a href="#登出和拒绝访问" class="headerlink" title="登出和拒绝访问"></a>登出和拒绝访问</h3><ul>
<li><code>.logoutUrl(&quot;&quot;)</code>处理登出请求的路由,即向该路由发送请求后执行登出操作</li>
<li><code>.logoutSuccessUrl(&quot;&quot;)</code>登出成功后跳转的界面</li>
<li><code>.accessDeniedPage(&quot;/access-denied&quot;)</code>访问被拒绝后跳转的界面</li>
</ul>
<p>完整的基础配置如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">http.antMatcher(<span class="string">&quot;/admin/**&quot;</span>)</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/admin/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line"></span><br><span class="line">                .and()</span><br><span class="line">                .formLogin()</span><br><span class="line">                .loginPage(<span class="string">&quot;/adminloginpage&quot;</span>)</span><br><span class="line">                .loginProcessingUrl(<span class="string">&quot;/admin/login&quot;</span>)</span><br><span class="line">                .successHandler(<span class="keyword">new</span> <span class="title class_">AdminAuthenticationSuccessHandler</span>())</span><br><span class="line">                .failureHandler(<span class="keyword">new</span> <span class="title class_">AdminAuthenticationFailureHandler</span>())</span><br><span class="line">                .permitAll()</span><br><span class="line">    </span><br><span class="line">                .and()</span><br><span class="line">                .logout()</span><br><span class="line">                .logoutUrl(<span class="string">&quot;/admin/logout&quot;</span>)</span><br><span class="line">                .logoutSuccessUrl(<span class="string">&quot;/adminloginpage&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">    </span><br><span class="line">                .exceptionHandling()</span><br><span class="line">                .accessDeniedPage(<span class="string">&quot;/access-denied&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">    </span><br><span class="line">                .csrf().disable();</span><br></pre></td></tr></table></figure>

<p>​	至此即启动了基本的登录验证,而如何后端如何处理登录请求以完成登录的过程在后文说明.</p>
<h1 id="4-限定ID的多表多身份登录验证"><a href="#4-限定ID的多表多身份登录验证" class="headerlink" title="4.限定ID的多表多身份登录验证"></a>4.限定ID的多表多身份登录验证</h1><p>​	为了实现前言中的需求,需要对Spring Security的服务类进行自定义,包括登录服务,权限验证服务等,另外需要多个Spring Security配置类来区分员工和管理员</p>
<h2 id="4-1管理员"><a href="#4-1管理员" class="headerlink" title="4.1管理员"></a>4.1管理员</h2><p>​	对于存在多个配置类的情况,需要为每个配置了设置优先级,管理员的安全的优先级应高于普通员工,因此将管理员的优先级设为1,普通员工的优先级设为2.使用<code>@Order()</code>注解为配置类设置优先级.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminSecurity</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-1-1-MyUserDetail"><a href="#4-1-1-MyUserDetail" class="headerlink" title="4.1.1 MyUserDetail"></a>4.1.1 MyUserDetail</h3><p>​	由于需要判断登录的用户是否可以访问&#x2F;**&#x2F;{userID},即userID要等于登录用户的ID,需要在Spring Security自带的UserDetail中增加一个属性,即userID,用于登录后获取登录用户的ID,自定的类即为MyUserDetail类,该类继承自Spring Security的UserDetail类.该类存储登录的相关信息,如登录用户的权限等.</p>
<p>​	由于员工和管理员都是需要一个userID属性,因此可以共用MyUserDetail类,该类如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyUserDetail</span> <span class="keyword">extends</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> userID;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyUserDetail</span><span class="params">(String username, String password, Collection&lt;? extends GrantedAuthority&gt; authorities)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(username, password, authorities);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserID</span><span class="params">(<span class="type">int</span> userID)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userID = userID;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getUserID</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userID;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-1-2-AdminUserDetailsService"><a href="#4-1-2-AdminUserDetailsService" class="headerlink" title="4.1.2 AdminUserDetailsService"></a>4.1.2 AdminUserDetailsService</h3><p>​	登录时需要通过数据库查询来验证用户名和密码,为登录用户分配身份(即权限),同时要为自定的MyUserDetail设置userID,因此需要一个自定的UserDetailsService类来处理登录请求.由于管理员和普通用户存储的表不同,具有的身份(权限)不同,因此要分开处理,为管理员创建AdminUserDetailsService类,继承自Spring Security的UserDetailsService类.</p>
<h4 id="1-loadUserByUsername-String-username"><a href="#1-loadUserByUsername-String-username" class="headerlink" title="1) loadUserByUsername(String username)"></a>1) loadUserByUsername(String username)</h4><p>​	该类中要重写父类的<code>loadUserByUsername(String username)</code> 的方法,该方法由Spring Security调用,传入登录的用户名,返回一个UserDetails对象,然后Spring Security验证登录的密码和UserDetail对象中存储的查询到的数据库中的密码是否一致,来判断是否能够登录.</p>
<p>​	根据需求,重写<code>loadUserByUsername()</code>,使其创建一个UserDetails对象,在这里创建UserDetails的子类MyUserDetail对象,根据用户名查询管理员表,获取到对应的密码,这里需要使用与配置类中一致的密码加密器对数据库中的明文密码进行加密,因为Spring Security验证的是加密后的密码,将加密后的密码赋予MyUserDetail对象.如果没有查询到该用户名,直接返回null.</p>
<p>​	然后为MyUserDetail对象赋予身份”ROLE_ADMIN”,注意这里与配置类中的<code>hasRole(&quot;ADMIN&quot;)</code>不同,因为Spring Security会自动去除前缀”ROLE_”,仅对比后面的”ADMIN”.最后将查询到的管理员的ID赋予给MyUserDetail对象,然后返回.该MyUserDetail对象会绑定该登录管理员,直到该管理员登出.</p>
<h4 id="2-checkUserID-Authentication-authentication-int-userID"><a href="#2-checkUserID-Authentication-authentication-int-userID" class="headerlink" title="2) checkUserID(Authentication authentication, int userID)"></a>2) checkUserID(Authentication authentication, int userID)</h4><p>​	为了实现判断登录管理员是否对”&#x2F;admin&#x2F;{userID}”具有访问权限,就不能简单使用<code>.hasRole(&quot;ADMIN&quot;)</code>进行判断,需要自己实现一个判断方法,返回boolean类型.该方法为<code>boolean checkUserID(Authentication authentication, int userID)</code>传入的authentication即为登录的上下文,通过该对象获取登录信息,传入的userID即为请求网址中的{userID}.</p>
<p>​	在该方法中,首先判断用户是否登录,若未登录直接返回false,然后通过authentication获取登录用户的MyUserDetail对象,通过MyUserDetail对象获取登录用户的userID和用户的身份.如果该用户具有身份”ROLE_ADMIN”且要访问的管理员主页&#x2F;admin&#x2F;{userID}中的userID等于该登录用户的ID,返回true,否则返回false.</p>
<h4 id="3-完整代码"><a href="#3-完整代码" class="headerlink" title="3) 完整代码"></a>3) 完整代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminUserDetailsService</span> <span class="keyword">implements</span>  <span class="title class_">UserDetailsService</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AdminMapper adminMapper;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;尝试加载Admin: &quot;</span>+<span class="string">&quot;username:&quot;</span>+username);</span><br><span class="line">        QueryWrapper&lt;Admins&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;admin_name&quot;</span>,username);</span><br><span class="line">        Admins admin=adminMapper.selectOne(queryWrapper);</span><br><span class="line">        <span class="keyword">if</span> (admin == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;Admin not found with username: &quot;</span> + username);</span><br><span class="line">        &#125;</span><br><span class="line">        GrantedAuthority grantedAuthority=<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;ROLE_ADMIN&quot;</span>);</span><br><span class="line">        BCryptPasswordEncoder bCryptPasswordEncoder=<span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">        String password=bCryptPasswordEncoder.encode(admin.getAdminPassword());</span><br><span class="line">        <span class="type">MyUserDetail</span> <span class="variable">myUserDetail</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyUserDetail</span>(username, password, Collections.singleton(grantedAuthority));</span><br><span class="line">        myUserDetail.setUserID(admin.getAdminNum());</span><br><span class="line">        <span class="keyword">return</span> myUserDetail;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkUserID</span><span class="params">(Authentication authentication, <span class="type">int</span> userID)</span> &#123;</span><br><span class="line">        <span class="comment">//首先检验用户是否登录</span></span><br><span class="line">        <span class="keyword">if</span>(authentication.getPrincipal().equals(<span class="string">&quot;anonymousUser&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">MyUserDetail</span> <span class="variable">userDetails</span> <span class="operator">=</span> (MyUserDetail) authentication.getPrincipal();</span><br><span class="line">        <span class="comment">//获取用户的权限</span></span><br><span class="line">        Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; authorities = userDetails.getAuthorities();</span><br><span class="line">        <span class="comment">// 检查用户权限</span></span><br><span class="line">        <span class="keyword">if</span> (authorities.contains(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;ROLE_ADMIN&quot;</span>))) &#123;</span><br><span class="line">            <span class="keyword">return</span> userDetails.getUserID() == userID; <span class="comment">// 用户拥有正确的身份和权限</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-1-3-AdminAuthenticationSuccessHandler"><a href="#4-1-3-AdminAuthenticationSuccessHandler" class="headerlink" title="4.1.3 AdminAuthenticationSuccessHandler"></a>4.1.3 AdminAuthenticationSuccessHandler</h3><p>​	由于登录成功后需要跳转到该管理员的主页,跳转的网页是动态生成的(&#x2F;admin&#x2F;{userID}),因此不能简单使用<code>.successForwardUrl()</code>设置一个跳转的静态网页.因此需要一个处理器来生成并跳转.</p>
<p>​	该处理器功能简单,即根据登录用户的ID动态重定向网页,它会通过Spring Security的登录上下文获取到当前登录用户的userDetail,从userDetail中获取登录用户的ID,根据该ID生成网址并跳转</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminAuthenticationSuccessHandler</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationSuccessHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">MyUserDetail</span> <span class="variable">userDetails</span> <span class="operator">=</span> (MyUserDetail) authentication.getPrincipal();</span><br><span class="line">        <span class="comment">// 获取用户的userID</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">userID</span> <span class="operator">=</span> userDetails.getUserID();</span><br><span class="line">        <span class="comment">// 构建重定向URL</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">targetUrl</span> <span class="operator">=</span> <span class="string">&quot;/admin/&quot;</span> + userID;</span><br><span class="line">        System.out.println(<span class="string">&quot;Redirecting to: &quot;</span> + targetUrl);</span><br><span class="line">        <span class="comment">// 重定向到目标URL</span></span><br><span class="line">        response.sendRedirect(targetUrl);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-1-4-AdminAuthenticationFailureHandler"><a href="#4-1-4-AdminAuthenticationFailureHandler" class="headerlink" title="4.1.4 AdminAuthenticationFailureHandler"></a>4.1.4 AdminAuthenticationFailureHandler</h3><p>​	与AdminAuthenticationSuccessHandler相似,处理登录失败跳转到的界面,即登录界面,但网址中添加了<code>error=true</code>参数,因为登录网页使用了thymelefa模板,根据添加的error参数来动态显示登录出错的提示信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminAuthenticationFailureHandler</span> <span class="keyword">extends</span> <span class="title class_">SimpleUrlAuthenticationFailureHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationFailure</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">// 设置自定义错误消息</span></span><br><span class="line">        setDefaultFailureUrl(<span class="string">&quot;/adminloginpage?error=true&quot;</span>); <span class="comment">// 这里设置了一个错误参数来标识登录失败</span></span><br><span class="line">        <span class="built_in">super</span>.onAuthenticationFailure(request, response, exception);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-1-5-AdminSecurity"><a href="#4-1-5-AdminSecurity" class="headerlink" title="4.1.5 AdminSecurity"></a>4.1.5 AdminSecurity</h3><p>​	最终根据自定的各种组件来配置Spring Security的配置类,实现对于管理员的登录检查.</p>
<p>​	 <span style="color:red;">注意:</span> 对于多Spring Security配置类的情况,要保证未被优先级高的配置类匹配的网址继续被低优先级的配置类尝试匹配,需要为每一个配置类设置网站过滤条件,否则所有网址都会被第一个配置类捕获,如果没有匹配成功,则会被直接放行而不会被下一个配置类处理.</p>
<p>​	在设置<code>.authorizeRequests()</code>之前,设置<code>.antMatcher(&quot;&quot;)</code>,表明该配置类只处理符合antMatcher中规则的网址,不符合的网址会被后续配置类尝试处理.</p>
<p>​	最终的AdminSecurity配置类代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminSecurity</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AdminUserDetailsService adminUserDetailsService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http.antMatcher(<span class="string">&quot;/admin/**&quot;</span>)</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/admin/workers-control&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/admin/departments-control&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/admin/worker/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/admin/register&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/admin/department/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/admin/leave/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/admin/evection/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/admin/query/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/admin/analyze/all&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)             .antMatchers(<span class="string">&quot;/admin/&#123;userID&#125;&quot;</span>).access(<span class="string">&quot;@adminUserDetailsService.checkUserID(authentication, #userID)&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .formLogin()</span><br><span class="line">                .loginPage(<span class="string">&quot;/adminloginpage&quot;</span>)</span><br><span class="line">                .loginProcessingUrl(<span class="string">&quot;/admin/login&quot;</span>)</span><br><span class="line">                .successHandler(<span class="keyword">new</span> <span class="title class_">AdminAuthenticationSuccessHandler</span>())</span><br><span class="line">                .failureHandler(<span class="keyword">new</span> <span class="title class_">AdminAuthenticationFailureHandler</span>())</span><br><span class="line">                .permitAll()</span><br><span class="line">                .and()</span><br><span class="line">                .logout()</span><br><span class="line">                .logoutUrl(<span class="string">&quot;/admin/logout&quot;</span>)</span><br><span class="line">                .logoutSuccessUrl(<span class="string">&quot;/adminloginpage&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .exceptionHandling()</span><br><span class="line">                .accessDeniedPage(<span class="string">&quot;/access-denied&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .csrf().disable();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        auth.userDetailsService(adminUserDetailsService).passwordEncoder(passwordEncoder2());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <span style="color:red;">注意:</span> 对于登录处理链接如&#x2F;admin&#x2F;login,要么保证其可以通过antMatcher(“&#x2F;admin&#x2F;**”),要么在配置中被设置为不需要登录验证,否则会被security拦截,导致无法登录</p>
<h2 id="4-2-普通用户"><a href="#4-2-普通用户" class="headerlink" title="4.2 普通用户"></a>4.2 普通用户</h2><blockquote>
<p>普通用户的Spring Security登录验证的配置与组件与管理员基本一致,因此不再详细说明,仅对不同的部分进行说明.</p>
</blockquote>
<h3 id="4-2-1-MyUserDetail"><a href="#4-2-1-MyUserDetail" class="headerlink" title="4.2.1 MyUserDetail"></a>4.2.1 MyUserDetail</h3><p>​	普通用户与管理员共用一个MyUserDeatil</p>
<h3 id="4-2-2-MyUserDetailsService"><a href="#4-2-2-MyUserDetailsService" class="headerlink" title="4.2.2 MyUserDetailsService"></a>4.2.2 MyUserDetailsService</h3><p>​	各函数的功能和流程均与AdminUserDetilService一致</p>
<h4 id="1-loadUserByUsername-String-username-1"><a href="#1-loadUserByUsername-String-username-1" class="headerlink" title="1) loadUserByUsername(String username)"></a>1) loadUserByUsername(String username)</h4><p>​	根据用户名查询密码和ID的数据库表由管理员表Admin改为普通用户表workers</p>
<h4 id="2-checkUserID-Authentication-authentication-int-userID-1"><a href="#2-checkUserID-Authentication-authentication-int-userID-1" class="headerlink" title="2) checkUserID(Authentication authentication, int userID)"></a>2) checkUserID(Authentication authentication, int userID)</h4><p>​	判断登录用户的身份时,身份由管理员(ROLE_ADMIN)改为普通用户(ROLE_USER)</p>
<h4 id="3-完整代码-1"><a href="#3-完整代码-1" class="headerlink" title="3) 完整代码"></a>3) 完整代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyUserDetailsService</span> <span class="keyword">implements</span>  <span class="title class_">UserDetailsService</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WorkersMapper workersMapper;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;尝试加载User: &quot;</span>+<span class="string">&quot;username:&quot;</span>+username);</span><br><span class="line">        QueryWrapper&lt;Workers&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;worker_name&quot;</span>,username);</span><br><span class="line">        Workers worker=workersMapper.selectOne(queryWrapper);</span><br><span class="line">        <span class="keyword">if</span> (worker == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;User not found with username: &quot;</span> + username);</span><br><span class="line">        &#125;</span><br><span class="line">        GrantedAuthority grantedAuthority=<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;ROLE_USER&quot;</span>);</span><br><span class="line">        BCryptPasswordEncoder bCryptPasswordEncoder=<span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">        String password=bCryptPasswordEncoder.encode(worker.getPassword());</span><br><span class="line">        <span class="type">MyUserDetail</span> <span class="variable">myUserDetail</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyUserDetail</span>(username, password, Collections.singleton(grantedAuthority));</span><br><span class="line">        myUserDetail.setUserID(worker.getWorkerNum());</span><br><span class="line">        <span class="keyword">return</span> myUserDetail;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkUserID</span><span class="params">(Authentication authentication, <span class="type">int</span> userID)</span> &#123;</span><br><span class="line">        <span class="comment">//首先检验用户是否登录</span></span><br><span class="line">        <span class="keyword">if</span>(authentication.getPrincipal().equals(<span class="string">&quot;anonymousUser&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">MyUserDetail</span> <span class="variable">userDetails</span> <span class="operator">=</span> (MyUserDetail) authentication.getPrincipal();</span><br><span class="line">        <span class="comment">//获取用户的权限</span></span><br><span class="line">        Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; authorities = userDetails.getAuthorities();</span><br><span class="line">        <span class="comment">// 检查用户权限</span></span><br><span class="line">        <span class="keyword">if</span> (authorities.contains(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;ROLE_USER&quot;</span>))) &#123;</span><br><span class="line">            <span class="keyword">return</span> userDetails.getUserID() == userID; <span class="comment">// 用户拥有正确的身份和权限</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-3-CustomAuthenticationSuccessHandler"><a href="#4-2-3-CustomAuthenticationSuccessHandler" class="headerlink" title="4.2.3 CustomAuthenticationSuccessHandler"></a>4.2.3 CustomAuthenticationSuccessHandler</h3><p>​	跳转的主页由*&#x2F;admin&#x2F;{userID}<em>改为</em>&#x2F;user&#x2F;{userID}*</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomAuthenticationSuccessHandler</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationSuccessHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">MyUserDetail</span> <span class="variable">userDetails</span> <span class="operator">=</span> (MyUserDetail) authentication.getPrincipal();</span><br><span class="line">        <span class="comment">// 获取用户的userID</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">userID</span> <span class="operator">=</span> userDetails.getUserID();</span><br><span class="line">        <span class="comment">// 构建重定向URL</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">targetUrl</span> <span class="operator">=</span> <span class="string">&quot;/user/&quot;</span> + userID;</span><br><span class="line">        System.out.println(<span class="string">&quot;用户登录成功，跳转到&quot;</span>+targetUrl);</span><br><span class="line">        <span class="comment">// 重定向到目标URL</span></span><br><span class="line">        response.sendRedirect(targetUrl);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-4-CustomAuthenticationFailureHandler"><a href="#4-2-4-CustomAuthenticationFailureHandler" class="headerlink" title="4.2.4 CustomAuthenticationFailureHandler"></a>4.2.4 CustomAuthenticationFailureHandler</h3><p>​	跳转的页面由管理员登录界面*&#x2F;adminloginpage?error&#x3D;true<em>改为普通用户登录界面</em>&#x2F;loginpage?error&#x3D;true*</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomAuthenticationFailureHandler</span> <span class="keyword">extends</span> <span class="title class_">SimpleUrlAuthenticationFailureHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationFailure</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">// 在这里可以自定义处理登录失败的逻辑，例如记录日志或者返回自定义的错误消息</span></span><br><span class="line">        <span class="comment">// 设置自定义错误消息</span></span><br><span class="line">        setDefaultFailureUrl(<span class="string">&quot;/loginpage?error=true&quot;</span>); <span class="comment">// 这里设置了一个错误参数来标识登录失败</span></span><br><span class="line">        <span class="built_in">super</span>.onAuthenticationFailure(request, response, exception);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-5-CustomSecurity"><a href="#4-2-5-CustomSecurity" class="headerlink" title="4.2.5 CustomSecurity"></a>4.2.5 CustomSecurity</h3><p>​	设置普通用户Spring Security配置类的优先级为2(低于管理员优先级即可,数字越大优先级越低),即Order(2)</p>
<p>​	将网址过滤条件从*&#x2F;admin&#x2F;<strong><em>改为</em>&#x2F;user&#x2F;</strong>*,将处理组件改为普通用户的处理组件,修改登录页面网址等.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order(2)</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomSecurity</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span>-</span><br><span class="line">    <span class="keyword">private</span> MyUserDetailsService myUserDetailsService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">                .antMatcher(<span class="string">&quot;/user/**&quot;</span>)</span><br><span class="line">                .authorizeRequests()           .antMatchers(<span class="string">&quot;/user/&#123;userID&#125;&quot;</span>).access(<span class="string">&quot;@myUserDetailsService.checkUserID(authentication, #userID)&quot;</span>)              .antMatchers(<span class="string">&quot;/user/info/&#123;userID&#125;&quot;</span>).access(<span class="string">&quot;@myUserDetailsService.checkUserID(authentication, #userID)&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .formLogin()</span><br><span class="line">                .loginPage(<span class="string">&quot;/loginpage&quot;</span>)</span><br><span class="line">                .loginProcessingUrl(<span class="string">&quot;/user/login&quot;</span>)</span><br><span class="line">                .successHandler(<span class="keyword">new</span> <span class="title class_">CustomAuthenticationSuccessHandler</span>())</span><br><span class="line">                .failureHandler(<span class="keyword">new</span> <span class="title class_">CustomAuthenticationFailureHandler</span>())</span><br><span class="line">                .permitAll()</span><br><span class="line">                .and()</span><br><span class="line">                .logout()</span><br><span class="line">                .logoutUrl(<span class="string">&quot;/user/logout&quot;</span>)</span><br><span class="line">                .logoutSuccessUrl(<span class="string">&quot;/loginpage&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .exceptionHandling()</span><br><span class="line">                .accessDeniedPage(<span class="string">&quot;/access-denied&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .csrf().disable();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        auth.userDetailsService(myUserDetailsService).passwordEncoder(passwordEncoder());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h1><p>​		Spring Security是一个基于Spring框架的安全性和身份验证框架，旨在为Java应用程序提供全面的安全解决方案。它为应用程序提供了一套强大的安全性服务，包括身份验证、授权、会话管理等功能.</p>
<p>​		Spring Security无缝集成到Spring框架中，为开发人员提供了一致性的编程和配置模型。这种集成性使得将安全性添加到现有的Spring应用程序变得相对简单，同时确保了代码的清晰性和可维护性。并且Spring Security支持多种身份验证机制，包括基本认证、表单登录、OAuth等，使得开发人员能够选择适合其应用程序需求的认证方式。同时，它提供了细粒度的授权机制，允许开发人员定义对应用程序资源的精确访问规则.</p>
<p>​		Spring Security具有高度的自定义性和高拓展性,可以通过自定义组件,与其他框架如MyBatis兼容,具有极高的灵活性:自定义认证提供者，开发人员可以实现自己的认证逻辑以满足特殊的身份验证需求.这使得可以集成多种认证机制，并根据应用程序的要求选择合适的认证方式;自定义用户详细信息服务,连接不同的用户存储后端，如数据库、LDAP等;自定义访问决策管理器,自定义对应用程序资源的访问规则,实现更细粒度的授权策略，满足特定的业务逻辑;可以使用表达式语言进行授权，这使得可以在配置文件中定义更加灵活和动态的授权规则,通过表达式，可以基于方法调用、请求路径等条件灵活地进行授权判断.本文实现的功能便是基于Spring Security的高灵活性和拓展性实现的.</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/11/12/YOLOv8%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/" rel="prev" title="YOLOv8操作指南">
      <i class="fa fa-chevron-left"></i> YOLOv8操作指南
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/01/27/%E5%B0%8F%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" rel="next" title="小问题解决方案">
      小问题解决方案 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">1.前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E4%BE%9D%E8%B5%96"><span class="nav-number">2.</span> <span class="nav-text">2.依赖</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81"><span class="nav-number">3.</span> <span class="nav-text">3. 登录验证</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1%E5%BC%80%E5%90%AFSpring-Security"><span class="nav-number">3.1.</span> <span class="nav-text">3.1开启Spring Security</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E9%85%8D%E7%BD%AE%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 配置登录验证</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%90%AF%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81"><span class="nav-number">3.2.1.</span> <span class="nav-text">开启登录验证</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2"><span class="nav-number">3.3.</span> <span class="nav-text">自定登录界面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%99%BB%E5%87%BA%E5%92%8C%E6%8B%92%E7%BB%9D%E8%AE%BF%E9%97%AE"><span class="nav-number">3.3.1.</span> <span class="nav-text">登出和拒绝访问</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E9%99%90%E5%AE%9AID%E7%9A%84%E5%A4%9A%E8%A1%A8%E5%A4%9A%E8%BA%AB%E4%BB%BD%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81"><span class="nav-number">4.</span> <span class="nav-text">4.限定ID的多表多身份登录验证</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1%E7%AE%A1%E7%90%86%E5%91%98"><span class="nav-number">4.1.</span> <span class="nav-text">4.1管理员</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-1-MyUserDetail"><span class="nav-number">4.1.1.</span> <span class="nav-text">4.1.1 MyUserDetail</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-2-AdminUserDetailsService"><span class="nav-number">4.1.2.</span> <span class="nav-text">4.1.2 AdminUserDetailsService</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-loadUserByUsername-String-username"><span class="nav-number">4.1.2.1.</span> <span class="nav-text">1) loadUserByUsername(String username)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-checkUserID-Authentication-authentication-int-userID"><span class="nav-number">4.1.2.2.</span> <span class="nav-text">2) checkUserID(Authentication authentication, int userID)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="nav-number">4.1.2.3.</span> <span class="nav-text">3) 完整代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-3-AdminAuthenticationSuccessHandler"><span class="nav-number">4.1.3.</span> <span class="nav-text">4.1.3 AdminAuthenticationSuccessHandler</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-4-AdminAuthenticationFailureHandler"><span class="nav-number">4.1.4.</span> <span class="nav-text">4.1.4 AdminAuthenticationFailureHandler</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-5-AdminSecurity"><span class="nav-number">4.1.5.</span> <span class="nav-text">4.1.5 AdminSecurity</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 普通用户</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-1-MyUserDetail"><span class="nav-number">4.2.1.</span> <span class="nav-text">4.2.1 MyUserDetail</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-2-MyUserDetailsService"><span class="nav-number">4.2.2.</span> <span class="nav-text">4.2.2 MyUserDetailsService</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-loadUserByUsername-String-username-1"><span class="nav-number">4.2.2.1.</span> <span class="nav-text">1) loadUserByUsername(String username)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-checkUserID-Authentication-authentication-int-userID-1"><span class="nav-number">4.2.2.2.</span> <span class="nav-text">2) checkUserID(Authentication authentication, int userID)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81-1"><span class="nav-number">4.2.2.3.</span> <span class="nav-text">3) 完整代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-3-CustomAuthenticationSuccessHandler"><span class="nav-number">4.2.3.</span> <span class="nav-text">4.2.3 CustomAuthenticationSuccessHandler</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-4-CustomAuthenticationFailureHandler"><span class="nav-number">4.2.4.</span> <span class="nav-text">4.2.4 CustomAuthenticationFailureHandler</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-5-CustomSecurity"><span class="nav-number">4.2.5.</span> <span class="nav-text">4.2.5 CustomSecurity</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-%E6%80%BB%E7%BB%93"><span class="nav-number">5.</span> <span class="nav-text">5. 总结</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="YQYjin"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">YQYjin</p>
  <div class="site-description" itemprop="description">任 重 而 道 远</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">60</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YQYjin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
